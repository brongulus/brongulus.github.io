<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>K8s on bacchanalian madness</title>
    <link>https://brongulus.github.io/tags/k8s/</link>
    <description>Recent content in K8s on bacchanalian madness</description>
    <generator>Hugo</generator>
    <language>en-us</language>
    <lastBuildDate>Fri, 29 Nov 2024 16:07:00 +0530</lastBuildDate>
    <atom:link href="https://brongulus.github.io/tags/k8s/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>MCM</title>
      <link>https://brongulus.github.io/notes/20241129t160749--mcm__k8s_sap_work/</link>
      <pubDate>Fri, 29 Nov 2024 16:07:00 +0530</pubDate>
      <guid>https://brongulus.github.io/notes/20241129t160749--mcm__k8s_sap_work/</guid>
      <description>&lt;p&gt;First, go through the &lt;a href=&#34;https://github.com/gardener/machine-controller-manager/blob/master/README.md&#34;&gt;README&lt;/a&gt;, later on check &lt;a href=&#34;https://github.com/gardener/machine-controller-manager/blob/master/docs/development/local_setup.md&#34;&gt;local setup&lt;/a&gt; guide as well.&lt;/p&gt;&#xA;&lt;h2 id=&#34;components&#34;&gt;Components&lt;/h2&gt;&#xA;&lt;p&gt;Check &lt;a href=&#34;https://github.com/gardener/machine-controller-manager/tree/master/kubernetes/crds&#34;&gt;CRDs present in the MCM tree&lt;/a&gt;&lt;/p&gt;&#xA;&lt;div class=&#34;warning&#34;&gt;&#xA;&lt;p&gt;All the below class diagrams omit &lt;code&gt;TypeMeta&lt;/code&gt; and &lt;code&gt;ObjectMeta&lt;/code&gt; for brevity.&lt;/p&gt;&#xA;&lt;/div&gt;&#xA;&lt;h3 id=&#34;machine&#34;&gt;Machine&lt;/h3&gt;&#xA;&lt;pre class=&#34;mermaid&#34;&gt;---&#xA;title: Machine&#xA;config:&#xA;  layout: elk&#xA;  class:&#xA;    hideEmptyMembersBox: true&#xA;---&#xA;%%{init: { &amp;#39;themeVariables&amp;#39;: { &amp;#39;lineColor&amp;#39;: &amp;#39;#51565b&amp;#39;}}}%%&#xA;classDiagram&#xA;   %% note &amp;#34;apiVersion, kind &amp;amp; metadata components have not been shown&amp;#34;&#xA;&#xA;   %% Machine ---------------------------------&#xA;   note for Machine &amp;#34;Representation of a physical or virtual machine that corresponds to a front-end kubernetes node object&amp;#34;&#xA;   Machine &amp;lt;|-- MachineSpec&#xA;   Machine &amp;lt;|-- MachineStatus&#xA;   class Machine{&#xA;   MachineSpec spec&#xA;   MachineStatus status&#xA;   }&#xA;   %%--&#xA;   MachineSpec &amp;lt;|-- ClassSpec&#xA;   MachineSpec &amp;lt;|-- MachineConfiguration&#xA;   MachineSpec &amp;lt;|-- NodeTemplateSpec&#xA;&#xA;   class MachineSpec{&#xA;   ClassSpec class&#xA;   string providerID&#xA;   NodeTemplateSpec nodeTemplate&#xA;   MachineConfiguration MachineConfiguration&#xA;   }&#xA;&#xA;   class ClassSpec{&#xA;   string apiGroup&#xA;   string kind&#xA;   string name&#xA;   }&#xA;   note for ClassSpec &amp;#34;Refers to the MachineClass template for the Machine&amp;#34;&#xA;&#xA;   class NodeTemplateSpec{&#xA;   string podCIDR: IP range&#xA;   []string podCIDRs&#xA;   string providerID&#xA;   bool unschedulable&#xA;   []taint taints&#xA;   NodeConfigSource* configSource: deprecated&#xA;   source externalID: deprected&#xA;   }&#xA;   note for NodeTemplateSpec &amp;#34;Actually part of NodeSpec which is a field in NodeTemplateSpec&amp;#34;&#xA;&#xA;   class MachineConfiguration{&#xA;   v1.Duration drainTimeout&#xA;   v1.Duration healthTimeout&#xA;   v1.Duration creationTimeout&#xA;   int32* maxEvictRetries&#xA;   string* nodeConditions&#xA;   }&#xA;   %%--&#xA;   MachineStatus &amp;lt;|-- LastOperation&#xA;   MachineStatus &amp;lt;|-- CurrentStatus&#xA;   class MachineStatus{&#xA;   v1.NodeCondition conditions&#xA;https://kubernetes.io/docs/reference/node/node-status/#condition&#xA;   LastOperation lastOperation&#xA;   CurrentStatus currentStatus&#xA;   string lastKnownState&#xA;   }&#xA;&#xA;   class LastOperation{&#xA;   string description&#xA;   string errorCode&#xA;   v1.Time lastUpdateTime&#xA;   MachineState state: string&#xA;   MachineOperationType type: string&#xA;   }&#xA;&#xA;   class CurrentStatus{&#xA;   MachinePhase phase: string&#xA;   bool timeoutActive&#xA;   v1.Time lastUpdateTime&#xA;   }&#xA;&#xA;   link MachineStatus &amp;#34;https://kubernetes.io/docs/reference/node/node-status/#condition&amp;#34;&#xA;&lt;/pre&gt;&#xA;&#xA;&lt;h3 id=&#34;machine-class&#34;&gt;Machine Class&lt;/h3&gt;&#xA;&lt;div class=&#34;mermaidbox&#34;&gt;&#xA;&lt;pre class=&#34;mermaid&#34;&gt;---&#xA;title: MachineClass&#xA;config:&#xA;  layout: elk&#xA;  class:&#xA;    hideEmptyMembersBox: true&#xA;---&#xA;%%{init: { &amp;#39;themeVariables&amp;#39;: { &amp;#39;lineColor&amp;#39;: &amp;#39;#51565b&amp;#39;}}}%%&#xA;classDiagram&#xA; %% MachineClass ---------------------------------&#xA;   note for MachineClass &amp;#34;Represents a template that contains cloud provider specific details used to create machines&amp;#34;&#xA;   MachineClass &amp;lt;|-- NodeTemplate&#xA;   class MachineClass{&#xA;   NodeTemplate nodeTemplate&#xA;   v1.SecretReference credentialsSecretRef&#xA;   RawExtension providerSpec&#xA;   string provider&#xA;   v1.SecretReference secretRef&#xA;   }&#xA;   note for MachineClass &amp;#34;credentialsSecretRef has cloud provider credentials&amp;lt;br&amp;gt;secretRef has cloud init script: bootstrap token, API server addr, kubeconfig&amp;#34;&#xA;   note for MachineClass &amp;#34;provider specific configuration to create a node is specified in providerSpec of the extensible custom type rawExtension which permits instances of different structure types to be held within a single type&amp;#34;&#xA;&#xA;   class NodeTemplate{&#xA;   v1.ResourceList capacity&#xA;   string instanceType&#xA;   string region&#xA;   string zone&#xA;   string* architecture&#xA;   }&#xA;&lt;/pre&gt;&#xA;&#xA;&lt;/div&gt;&#xA;&lt;h3 id=&#34;machine-set&#34;&gt;Machine Set&lt;/h3&gt;&#xA;&lt;div class=&#34;mermaidbox&#34;&gt;&#xA;&lt;pre class=&#34;mermaid&#34;&gt;---&#xA;title: MachineSet&#xA;config:&#xA;  layout: elk&#xA;  class:&#xA;    hideEmptyMembersBox: true&#xA;---&#xA;%%{init: { &amp;#39;themeVariables&amp;#39;: { &amp;#39;lineColor&amp;#39;: &amp;#39;#51565b&amp;#39;}}}%%&#xA;classDiagram&#xA; %% MachineSet ---------------------------------&#xA;   note for MachineSet &amp;#34;Ensures that the specified number of Machine replicas are running at any time&amp;#34;&#xA;   MachineSet &amp;lt;|-- MachineSetSpec&#xA;   MachineSet &amp;lt;|-- MachineSetStatus&#xA;   class MachineSet{&#xA;   MachineSetSpec spec&#xA;   MachineSetStatus status&#xA;   }&#xA;&#xA;   MachineSetSpec &amp;lt;|-- ClassSpec&#xA;   MachineSetSpec &amp;lt;|-- MachineTemplateSpec&#xA;   class MachineSetSpec{&#xA;   int32 replicas&#xA;   v1.LabelSelector selector&#xA;   ClassSpec machineClass&#xA;   MachineTemplateSpec template&#xA;   int32 minReadySeconds&#xA;   }&#xA;&#xA;   MachineTemplateSpec &amp;lt;|-- MachineSpec&#xA;   class MachineTemplateSpec{&#xA;   MachineSpec spec&#xA;   }&#xA;&#xA;   MachineSetStatus &amp;lt;|-- MachineSetCondition&#xA;   MachineSetStatus &amp;lt;|-- LastOperation&#xA;   MachineSetStatus &amp;lt;|-- MachineSummary&#xA;   class MachineSetStatus{&#xA;   int32 replicas&#xA;   int32 fullyLabeledReplicas&#xA;   int32 readyReplicas&#xA;   int32 availableReplicas&#xA;   int64 observedGeneration&#xA;   []MachineSetCondition machineSetCondition&#xA;   LastOperation lastOperation&#xA;   MachineSummary failedMachines&#xA;   }&#xA;&#xA;   MachineSummary &amp;lt;|-- LastOperation&#xA;   class MachineSummary{&#xA;   string name&#xA;   string providerID&#xA;   LastOperation lastOperation&#xA;   string ownerRef&#xA;   }&#xA;&#xA;   class MachineSetCondition{&#xA;   MachineSetConditionType type: string&#xA;   ConditionStatus status: string&#xA;   v1.Time lastTransitionTime&#xA;   string reason&#xA;   string message&#xA;   }&#xA;&#xA;   note for MachineSetCondition &amp;#34;Can it not be the same as machine deployment condition?&amp;#34;&#xA;   note for LastOperation &amp;#34;One has information about lastOp for Machine (summary) and the other is for MachineSet&amp;#34;&#xA;&lt;/pre&gt;&#xA;&#xA;&lt;/div&gt;&#xA;&lt;h3 id=&#34;machine-deployment&#34;&gt;Machine Deployment&lt;/h3&gt;&#xA;&lt;div class=&#34;mermaidbox&#34;&gt;&#xA;&lt;pre class=&#34;mermaid&#34;&gt;---&#xA;title: MachineDeployment&#xA;config:&#xA;  layout: elk&#xA;  class:&#xA;    hideEmptyMembersBox: true&#xA;---&#xA;%%{init: { &amp;#39;themeVariables&amp;#39;: { &amp;#39;lineColor&amp;#39;: &amp;#39;#51565b&amp;#39;}}}%%&#xA;classDiagram&#xA; %% Deployment ---------------------------------&#xA;   note for MachineDeployment &amp;#34;Provides a declarative update for MachineSet and Machines&amp;#34;&#xA;   MachineDeployment &amp;lt;|-- MachineDeploymentSpec&#xA;   MachineDeployment &amp;lt;|-- MachineDeploymentStatus&#xA;   class MachineDeployment{&#xA;   MachineDeploymentSpec spec&#xA;   MachineDeploymentStatus status&#xA;   }&#xA;   %%--&#xA;   MachineDeploymentSpec &amp;lt;|-- MachineTemplateSpec&#xA;   MachineDeploymentSpec &amp;lt;|-- MachineDeploymentStrategy&#xA;   class MachineDeploymentSpec{&#xA;   int32 replicas&#xA;   v1.LabelSelector selector&#xA;   MachineTemplateSpec template&#xA;   MachineDeploymentStrategy strategy&#xA;   int32 minReadySeconds&#xA;   int32* revisionHistoryLimit&#xA;   bool paused&#xA;      int32* progressDeadlineSeconds&#xA;   }&#xA;&#xA;   MachineDeploymentStrategy &amp;lt;|-- RollingUpdateMachineDeployment&#xA;   class MachineDeploymentStrategy{&#xA;   MachineDeploymentStrategyType type: string&#xA;   RollingUpdateMachineDeployment rollingUpdate&#xA;   }&#xA;&#xA;   class RollingUpdateMachineDeployment{&#xA;   IntOrString MaxUnavailable&#xA;   IntOrString MaxSurge&#xA;   }&#xA;   %%--&#xA;   MachineDeploymentStatus &amp;lt;|-- MachineDeploymentCondition&#xA;   MachineDeploymentStatus &amp;lt;|-- MachineSummary&#xA;   class MachineDeploymentStatus{&#xA;   int64 observedGeneration&#xA;   int32 replicas&#xA;   int32 updatedReplicas&#xA;   int32 readyReplicas&#xA;   int32 availableReplicas&#xA;   int32 unavailableReplicas&#xA;   []MachineDeploymentCondition condition&#xA;   int32* collisionCount&#xA;   MachineSummary failedMachines&#xA;   }&#xA;&#xA;   class MachineDeploymentCondition{&#xA;   MachineDeploymentConditionType type: string&#xA;   ConditionStatus status: string&#xA;   v1.Time lastUpdateTime&#xA;   v1.Time lastTransitionTime&#xA;   string reason&#xA;   string message&#xA;   }&#xA;&lt;/pre&gt;&#xA;&#xA;&lt;/div&gt;&#xA;&lt;h2 id=&#34;controllers&#34;&gt;Controllers&lt;/h2&gt;&#xA;&lt;h3 id=&#34;reconcile-cluster-secret&#34;&gt;Reconcile Cluster Secret&lt;/h3&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;Fetch secrets&lt;/li&gt;&#xA;&lt;li&gt;Get the &lt;code&gt;MachineClass&lt;/code&gt; referring to the passed secret&lt;/li&gt;&#xA;&lt;li&gt;In case there are machine classes that refer it, add the finalizer to the secret else remove it. (The removal of the finalizer is needed because if the secrets aren&amp;rsquo;t referred by &lt;code&gt;MachineClass&lt;/code&gt; then their deletion shouldn&amp;rsquo;t depend on the finalizer, &lt;a href=&#34;https://kubernetes.io/docs/concepts/overview/working-with-objects/finalizers/&#34;&gt;Ref&lt;/a&gt;)&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;h3 id=&#34;reconcile-cluster-machine-class&#34;&gt;Reconcile Cluster Machine Class&lt;/h3&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;Fetch the &lt;code&gt;MachineClass&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;Get all the &lt;code&gt;Machines&lt;/code&gt; referring to the &lt;code&gt;MachineClass&lt;/code&gt;.&lt;/li&gt;&#xA;&lt;li&gt;If there are machines that match given &lt;code&gt;MachineClass&lt;/code&gt; and the deletion hasn&amp;rsquo;t been requested yet for the &lt;code&gt;Class&lt;/code&gt; then add the finalizers to the class proceeding which all the machines referring to the class are enqueued for further processing. (&lt;code&gt;TODO&lt;/code&gt;: Learn about &lt;a href=&#34;https://pkg.go.dev/k8s.io/client-go/util/workqueue&#34;&gt;workqueue&lt;/a&gt;)&lt;/li&gt;&#xA;&lt;li&gt;Otherwise if deletion isn&amp;rsquo;t scheduled and there are machines referring to the Class then add them to the &lt;code&gt;machineQueue&lt;/code&gt;.&lt;/li&gt;&#xA;&lt;li&gt;If there aren&amp;rsquo;t any machines referring to the &lt;code&gt;Class&lt;/code&gt;, then the finalizers, if any, on it can be deleted.&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;h3 id=&#34;reconcile-cluster-machine&#34;&gt;Reconcile Cluster Machine&lt;/h3&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;Fetch the required &lt;code&gt;Machine&lt;/code&gt;.&lt;/p&gt;</description>
    </item>
    <item>
      <title>Docker Kubernetes Notes</title>
      <link>https://brongulus.github.io/notes/20241108t095209--docker-k8s-training__k8s_sap/</link>
      <pubDate>Fri, 08 Nov 2024 09:52:00 +0530</pubDate>
      <guid>https://brongulus.github.io/notes/20241108t095209--docker-k8s-training__k8s_sap/</guid>
      <description>&lt;h2 id=&#34;docker&#34;&gt;Docker&lt;/h2&gt;&#xA;&lt;p&gt;A container is a standard unit of software that packages up code and all its dependencies so the application runs quickly and reliably from one computing environment to another. The Linux kernel does not know about containers at all â€“ for it, containers are nothing more than just regular processes running on the system. It however offers several features that Docker and other container engines leverage to achieve an almost complete isolation of processes from each other. Some of them being&lt;/p&gt;</description>
    </item>
  </channel>
</rss>
